<%- include('layout', { body: `
  <!-- Page Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold text-slate-900">Empfehlungscode</h1>
      <p class="text-slate-500 mt-1">Verwaltung von Empfehlungen</p>
    </div>
    ${user.role === 'admin' ? `
      <button 
        onclick="openEmpfehlungModal()"
        data-testid="add-empfehlung-btn"
        class="inline-flex items-center justify-center h-10 px-4 rounded-md bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 transition-all duration-200 gap-2"
      >
        <i data-lucide="plus" class="w-4 h-4"></i>
        Empfehlung hinzufügen
      </button>
    ` : ''}
  </div>

  <!-- Empfehlungen Table -->
  <div class="rounded-xl border border-slate-200 bg-white shadow-sm" data-testid="empfehlungen-table-card">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b border-slate-200 bg-slate-50">
            <th class="h-12 px-4 text-left align-middle text-sm font-medium text-slate-500">Vorname</th>
            <th class="h-12 px-4 text-left align-middle text-sm font-medium text-slate-500">Nachname</th>
            <th class="h-12 px-4 text-left align-middle text-sm font-medium text-slate-500 hidden md:table-cell">Abholort</th>
            <th class="h-12 px-4 text-left align-middle text-sm font-medium text-slate-500 hidden md:table-cell">Abgabeort</th>
            <th class="h-12 px-4 text-left align-middle text-sm font-medium text-slate-500">Datum</th>
            ${user.role === 'admin' ? `
              <th class="h-12 px-4 text-right align-middle text-sm font-medium text-slate-500">Aktionen</th>
            ` : ''}
          </tr>
        </thead>
        <tbody>
          ${empfehlungen.length === 0 ? `
            <tr>
              <td colspan="${user.role === 'admin' ? '6' : '5'}" class="p-8 text-center text-slate-500">
                <i data-lucide="gift" class="w-12 h-12 mx-auto mb-3 text-slate-300"></i>
                <p>Keine Empfehlungen gefunden</p>
              </td>
            </tr>
          ` : empfehlungen.map(emp => `
            <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors" data-testid="empfehlung-row-${emp.id}">
              <td class="p-4 font-medium text-slate-900">${emp.vorname}</td>
              <td class="p-4 text-slate-600">${emp.nachname}</td>
              <td class="p-4 text-slate-600 hidden md:table-cell">${emp.abholort}</td>
              <td class="p-4 text-slate-600 hidden md:table-cell">${emp.abgabeort}</td>
              <td class="p-4 text-sm text-slate-600">${new Date(emp.created_at).toLocaleDateString('de-DE')}</td>
              ${user.role === 'admin' ? `
                <td class="p-4 text-right">
                  <form method="POST" action="/empfehlungen/delete/${emp.id}" onsubmit="return confirm('Sind Sie sicher?')">
                    <button 
                      type="submit"
                      data-testid="delete-empfehlung-${emp.id}"
                      class="inline-flex items-center justify-center w-8 h-8 rounded-md hover:bg-red-50 transition-all duration-200"
                    >
                      <i data-lucide="trash-2" class="w-4 h-4 text-red-600"></i>
                    </button>
                  </form>
                </td>
              ` : ''}
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Add Empfehlung Modal -->
  <div id="empfehlungModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/50" onclick="closeEmpfehlungModal()"></div>
    <div class="relative w-full max-w-lg bg-white rounded-xl shadow-xl" data-testid="empfehlung-modal">
      <div class="p-6 border-b border-slate-200">
        <h3 class="text-lg font-semibold text-slate-900">Empfehlung hinzufügen</h3>
        <button onclick="closeEmpfehlungModal()" class="absolute top-4 right-4 p-2 rounded-lg hover:bg-slate-100">
          <i data-lucide="x" class="w-5 h-5 text-slate-500"></i>
        </button>
      </div>
      <form method="POST" action="/empfehlungen/add">
        <div class="p-6 space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-2">Vorname *</label>
              <input type="text" name="vorname" required data-testid="empfehlung-vorname-input"
                     class="flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2">
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-2">Nachname *</label>
              <input type="text" name="nachname" required data-testid="empfehlung-nachname-input"
                     class="flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2">
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">Abholort *</label>
            <input type="text" name="abholort" required data-testid="empfehlung-abholort-input"
                   class="flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2"
                   placeholder="z.B. Berlin Mitte">
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">Abgabeort *</label>
            <input type="text" name="abgabeort" required data-testid="empfehlung-abgabeort-input"
                   class="flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2"
                   placeholder="z.B. Berlin Kreuzberg">
          </div>
        </div>
        <div class="p-6 border-t border-slate-200 flex justify-end gap-3">
          <button type="button" onclick="closeEmpfehlungModal()"
                  class="h-10 px-4 rounded-md border border-slate-200 bg-white text-slate-900 text-sm font-medium hover:bg-slate-100 transition-all duration-200">
            Abbrechen
          </button>
          <button type="submit" data-testid="empfehlung-submit-btn"
                  class="h-10 px-4 rounded-md bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 transition-all duration-200">
            Hinzufügen
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    function openEmpfehlungModal() {
      document.getElementById('empfehlungModal').classList.remove('hidden');
      lucide.createIcons();
    }

    function closeEmpfehlungModal() {
      document.getElementById('empfehlungModal').classList.add('hidden');
    }
    
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeEmpfehlungModal();
    });
  </script>
` }) %>
